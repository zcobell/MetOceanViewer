<!-- 
//---- LGPL --------------------------------------------------------------------
//
// Copyright (C)  ARCADIS, 2011-2013.
//
// This program is free software: you can redistribute it and/or modify
// it under the terms of the GNU Lesser General Public License as published by
// the Free Software Foundation version 3.
//
// This program is distributed in the hope that it will be useful,
// but WITHOUT ANY WARRANTY; without even the implied warranty of
// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
// GNU Lesser General Public License for more details.
//
// You should have received a copy of the GNU Lesser General Public License
// along with this program.  If not, see <http://www.gnu.org/licenses/>.
//
// contact: Zachary Cobell, zachary.cobell@arcadis-us.com
// ARCADIS
// 4999 Pearl East Circle, Suite 200
// Boulder, CO 80301
//
// All indications and logos of, and references to, "ARCADIS" 
// are registered trademarks of ARCADIS, and remain the property of
// ARCADIS. All rights reserved.
//
//------------------------------------------------------------------------------
// $Author$
// $Date$
// $Id$
// $HeadURL$
//------------------------------------------------------------------------------
//  File: imeds_maps.html
//
//------------------------------------------------------------------------------
-->
        
<!DOCTYPE html>
<html>
  <head>
    <meta name="viewport" content="initial-scale=1.0, user-scalable=no" />
    <style type="text/css">
      html { height: 100% }
      body { height: 100%; margin: 0; padding: 0 }
      #map_canvas { height: 100% }
    </style>

    <!-- Load the google maps api and the google visualization api -->
    <script src="http://ajax.googleapis.com/ajax/libs/jquery/1.8.2/jquery.min.js"></script>
    <script src="/js/highcharts.js"></script>
    <script src="/js/modules/exporting.js"></script>

    <script src="https://maps.googleapis.com/maps/api/js?v=3.exp&sensor=false"></script>
    <script type="text/javascript">

    var IMEDSMarkers = [];
    var IMEDSInfoWindow = [];

    function clearMarkers()
    {
        while(IMEDSMarkers[0])
        {
            IMEDSMarkers.pop().setMap(null);
        }
    }

    function fitMarkers()
    {
        var extent = new google.maps.LatLngBounds();
        var nMarker = IMEDSMarkers.length;
        for(i=0;i<nMarker;i++)
        {
            extent.extend(IMEDSMarkers[i].getPosition());
        }
        map.fitBounds(extent);
    }

    function addValidationStation(DoADC,DoOBS,x,y,ID,name,Range,RawDataADC,RawDataOBS){
          var myLatlng = new google.maps.LatLng(y,x);
          IMEDSMarkers[ID] = new google.maps.Marker({
              position: myLatlng,
              map: map,
              title: String(ID)
          });
          var contentString = "<b>Validation Station:</b> "+name;
          IMEDSInfoWindow[ID] = new google.maps.InfoWindow({content: contentString});
          google.maps.event.addListener(IMEDSMarkers[ID], 'click', function() {
            //Set the Marker ID
            window.markerID = ID;
            if(window.LastInfo!=-1)
            {
                window.LastInfo.close();
            }
            window.LastInfo = IMEDSInfoWindow[ID];
            IMEDSInfoWindow[ID].open(map,IMEDSMarkers[ID]);
            PlotValidationData(DoADC,DoOBS,name,RawDataADC,RawDataOBS,Range);
          });

      }

      ////////////////////////////////////////////////////////////
      //   PAN TO FUNCTION                                      //
      //                                                        //
      //  Function to pan to a different x,y,zoom on the map    //
      ////////////////////////////////////////////////////////////
      function panToIMEDS(x,y,z){
        var center = new google.maps.LatLng(y,x);
        map.setCenter(center);
        map.setZoom(z);
      }

      ////////////////////////////////////////////////////////////
      //   INITIALIZE FUNCTION                                  //
      //                                                        //
      //  Function to initialize the google maps area on load   //
      ////////////////////////////////////////////////////////////
      function initializeIMEDS() {
        //Initialize the map

        window.LastInfo = -1;
        var myOptions = {
          center: new google.maps.LatLng(29.5, -91.5),
          zoom: 8,
          mapTypeId: google.maps.MapTypeId.ROADMAP,
          panControl: true,
          streetViewControl: false
        };
        map = new google.maps.Map(document.getElementById("map_canvas"), myOptions);
       }


      function PlotValidationData(DoADC,DoOBS,StationName,RawDataADC,RawDataOBS,Range) {

        //Set the ymin/ymax values
        if(Range=="auto")
        {
            var autorange = 1;
        }
        else
        {
            var autorange = 0;
            TempRange = Range.split(":");
            var ymin = Number(TempRange[0]);
            var ymax = Number(TempRange[1]);
        }

        //Split by rows
        RawDataOBS2 = RawDataOBS.split(";");
        RawDataADC2 = RawDataADC.split(";");

        //Split the rows into their pieces
        if(DoOBS == 1)
        {
            IMEDSData = new Array();
            var TempDataOBS = new Array();
            for(var i=0;i<RawDataOBS2.length;i++)
            {
                TempDataOBS = RawDataOBS2[i].split(":");
                IMEDSData[i] = new Array();
                for(var j=0;j<TempDataOBS.length;j++)
                {
                    IMEDSData[i][j] = TempDataOBS[j];
                }
                if(Number(IMEDSData[i][5]) < -400)
                {
                    IMEDSData[i][5] = -9999;
                }
            }
        }

        if(DoADC == 1)
        {
            ADCData = new Array();
            var TempDataADC = new Array();
            for(i=0;i<RawDataADC2.length;i++)
            {
                TempDataADC = RawDataADC2[i].split(":");
                ADCData[i] = new Array();
                for(var j=0;j<TempDataADC.length;j++)
                {
                    ADCData[i][j] = TempDataADC[j];
                }
                if(Number(ADCData[i][5]) < -400)
                {
                    ADCData[i][5] = -9999;
                }
            }
        }

        // Create the data tables
        var idx;
        var idx2;
        var ThisDate;
        var ThisData;
        if(DoOBS == 1)
        {
            idx2 = -1;
            var OBSPlottingData = new Array();
            for(idx=0; idx<IMEDSData.length;idx++)
            {
                ThisDate = Date.UTC(Number(IMEDSData[idx][0]),Number(IMEDSData[idx][1])-1,
                                    Number(IMEDSData[idx][2]),Number(IMEDSData[idx][3]),
                                    Number(IMEDSData[idx][4]),0,0);
                ThisData = Number(IMEDSData[idx][5]);
                if(ThisData>-999)
                {
                    idx2                      = idx2 + 1;
                    OBSPlottingData[idx2]     = new Array();
                    OBSPlottingData[idx2][0]  = ThisDate;
                    OBSPlottingData[idx2][1]  = ThisData;
                }
            }
        }

        if(DoADC == 1)
        {
            idx2 = -1;
            var ADCPlottingData = new Array();
            for(idx=0; idx<ADCData.length;idx++)
            {
                ThisDate = Date.UTC(Number(ADCData[idx][0]),Number(ADCData[idx][1])-1,
                                    Number(ADCData[idx][2]),Number(ADCData[idx][3]),
                                    Number(ADCData[idx][4]),0,0);
                ThisData = Number(ADCData[idx][5]);
                if(ThisData>-999)
                {
                    idx2                      = idx2 + 1;
                    ADCPlottingData[idx2]     = new Array();
                    ADCPlottingData[idx2][0]  = ThisDate;
                    ADCPlottingData[idx2][1]  = ThisData;
                }
            }
        }


        // Create the HighChart
        if(DoOBS == 1 && DoADC == 1)
        {
            $('#plot_area').highcharts({
                chart: {
                    type: 'line',
                    zoomType: 'xy'
                },
                exporting: {
                         enabled: false
                },
                title: {
                    text: 'Timeseries Station Data'
                },
                subtitle: {
                    text: 'Station '+StationName
                },
                xAxis: {
                    type: 'datetime',
                    title: { text: 'Date (GMT)' },
                    dateTimeLabelFormats: { // don't display the dummy year
                        month: '%e. %b',
                        year: '%b'
                    }
                },
                yAxis: {
                    title: {
                        text: 'Water Surface Elevation (m,NAVD88)'
                    },
                },
                plotOptions: {
                    series: {
                        marker: {
                            enabled: false
                            },
                        animation: {
                           enabled: true,
                           duration: 1000,
                           easing: 'linear'
                        },
                    }
                },
                tooltip: {
                    formatter: function() {
                            return '<b>'+ this.series.name +'</b><br/>'+
                            Highcharts.dateFormat('%b %e, %Y %l:%M%p', this.x) +': '+ this.y +' ';
                    }
                },
                series: [{
                    name: 'ADCIRC',
                    data: ADCPlottingData
                        },{
                    name: 'Observation',
                    data: OBSPlottingData
                    }]
            });
        }
        if(DoOBS == 1 && DoADC == 0)
        {
            $('#plot_area').highcharts({
                chart: {
                    type: 'line',
                    zoomType: 'xy'
                },
                exporting: {
                         enabled: false
                },
                title: {
                    text: 'Timeseries Station Data'
                },
                subtitle: {
                    text: 'Station '+StationName
                },
                xAxis: {
                    type: 'datetime',
                    title: { text: 'Date (GMT)' },
                    dateTimeLabelFormats: { // don't display the dummy year
                        month: '%e. %b',
                        year: '%b'
                    }
                },
                yAxis: {
                    title: {
                        text: 'Water Surface Elevation (m,NAVD88)'
                    },
                },
                plotOptions: {
                    series: {
                        marker: {
                            enabled: false
                            },
                        animation: {
                           enabled: true,
                           duration: 1500,
                           easing: 'linear'
                        },
                    }
                },
                tooltip: {
                    formatter: function() {
                            return '<b>'+ this.series.name +'</b><br/>'+
                            Highcharts.dateFormat('%b %e, %Y %l:%M%p', this.x) +': '+ this.y +' ';
                    }
                },
                series: [{
                    name: 'Observation',
                    data: OBSPlottingData
                    }]
            });
        }
        else if(DoOBS == 0 && DoADC == 1)
        {
            $('#plot_area').highcharts({
                chart: {
                    type: 'line',
                    zoomType: 'xy'
                },
                exporting: {
                         enabled: false
                },
                title: {
                    text: 'Timeseries Station Data'
                },
                subtitle: {
                    text: 'Station '+StationName
                },
                xAxis: {
                    type: 'datetime',
                    title: { text: 'Date (GMT)' },
                    dateTimeLabelFormats: { // don't display the dummy year
                        month: '%e. %b',
                        year: '%b'
                    }
                },
                yAxis: {
                    title: {
                        text: 'Water Surface Elevation (m,NAVD88)'
                    },
                },
                plotOptions: {
                    series: {
                        marker: {
                            enabled: false
                            },
                        animation: {
                           enabled: true,
                           duration: 1500,
                           easing: 'linear'
                        },
                    }
                },
                tooltip: {
                    formatter: function() {
                            return '<b>'+ this.series.name +'</b><br/>'+
                            Highcharts.dateFormat('%b %e, %Y %l:%M%p', this.x) +': '+ this.y +' ';
                    }
                },
                series: [{
                    name: 'ADCIRC',
                    data: ADCPlottingData
                    }]
            });
        }


        return;
      }


    </script>
  </head>
  <body onload="initializeIMEDS()">
      <div style="height:100%; width: 100%; display: table">
          <div style="display: table-row">
            <div id="map_canvas" style="width: 50%; display: table-cell;"></div>
            <div id="plot_area" style="width: 50%; display: table-cell;"></div>
          </div>
      </div>
  </body>
</html>

